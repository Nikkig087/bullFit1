{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}
  <h1>{{ exercise.title }}</h1>
  <p>{{ exercise.description }}</p>

  <h3>Comments ({{ comment_count }})</h3>
  <ul>
    {% for comment in comments %}
      {% if comment.approved %}
        <li>{{ comment.comment }} - {{ comment.user.username }} on {{ comment.created_on }}
          {% if comment.user == request.user %}
            <!-- Edit and Delete Buttons -->
            <a href="{% url 'edit_comment' exercise.pk comment.pk %}" class="btn btn-primary">Edit</a>
            <button class="btn btn-danger btn-delete" data-comment_id="{{ comment.pk }}" data-exercise_pk="{{ exercise.pk }}">Delete</button>
          {% endif %}
        </li>
      {% else %}
        <li>Comment awaiting approval</li>
      {% endif %}
    {% endfor %}
  </ul>

  <h3>Leave a Comment</h3>
  <form method="post">
    {% csrf_token %}
    {{ comment_form.as_p }}
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>

 <!-- Message Modal -->
<div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="messageModalLabel">Message</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <!-- Message content will be injected here by JavaScript -->
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
      </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              Are you sure you want to delete this comment?
          </div>
          <div class="modal-footer">
              <a id="deleteConfirm" href="#" class="btn btn-danger">Delete</a>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          </div>
      </div>
  </div>
</div>

{% endblock %}

{% block extras %}
  


<!-- Include Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="{% static 'js/comments.js' %}"></script>
  {% endblock %}
